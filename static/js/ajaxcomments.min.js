(function(d){function m(){n=this.name}function A(a){a.preventDefault();var c="preview"==n;B(a.target,{onsuccess:c?null:C,preview:c});return!1}function p(a,c){var b=d("#c"+a);0==b.length?window.console&&console.warn("scrollToComment() - #c"+a+" not found."):window.on_scroll_to_comment&&!1===window.on_scroll_to_comment({comment:b})||r(b,c,40)}function r(a,c,b){a.length&&d(t).animate({scrollTop:a.offset().top-(b||0)},c||1E3)}function C(a,c,b,e){var h=b?d("#comment-moderated-message-"+c).fadeIn(200):
d("#comment-added-message-"+c).fadeIn(200);setTimeout(function(){p(a,1E3)},1E3);setTimeout(function(){h.fadeOut(500)},4E3)}function u(a){a.preventDefault();var c=d(this);a=c.attr("data-comment-id");c=c.closest(".comment-item");q();d(".js-comments-form").appendTo(c);d(c.find("#id_parent")[0]).val(a)}function D(a){a&&a.preventDefault();a=d(a.target).closest("form.js-comments-form");v(a);q()}function q(){var a=d("li.comment-preview");if(0==a.length)return!1;var c=a.parent();1==c.children("li").length?
c.remove():a.remove();return!0}function v(a){var c=a.attr("data-object-id");d(a[0].elements.comment).val("");d(a[0].elements.parent).val("");a.appendTo(d("#comments-form-orig-position-"+c))}function B(a,c){var b=c.onsuccess,e=!!c.preview;if(a.commentBusy)return!1;a.commentBusy=!0;var h=d(a),m=h.serialize()+(e?"&preview=1":""),n=h.attr("action")||"./",p=h.attr("data-ajax-action");e||d("#comment-waiting").fadeIn(1E3);d.ajax({type:"POST",url:p||n,data:m,dataType:"json",success:function(f){a.commentBusy=
!1;w(h);h.find(".js-errors").remove();h.find(".control-group.error").removeClass("error");h.find(".form-group.has-error").removeClass("has-error");if(f.success){if(e)var k=E(f);else{v(h);k=d("#comments-"+f.object_id);if(f.use_threadedcomments)k=q();else{var g=k.find(".comment-preview-area"),l=g.hasClass("has-preview-loaded");x?g.remove():g.html("");g.removeClass("has-preview-loaded");k.removeClass("has-preview");k=l}y(f,"").append(f.html).removeClass("empty");g=d("#c"+f.comment_id);k?g.hide().fadeIn(600):
g.hide().show(600);k=g}if(b)c.onsuccess(f.comment_id,f.object_id,f.is_moderated,k)}else for(g in k=d("form#comment-form-"+f.object_id)[0],f.errors)g&&(l=d(k.elements[g]),l.after('<span class="js-errors">'+f.errors[g]+"</span>"),l.closest(".control-group").addClass("error"),l.closest(".form-group").addClass("has-error"))},error:function(c,b,d){a.commentBusy=!1;w(h);(response=c.responseText)&&window.console&&-1!=response.indexOf("DJANGO_SETTINGS_MODULE")&&console.error(response);alert("Internal CMS error: failed to post comment data!")}});
return!1}function y(a,c){var b=a.parent_id,e=a.object_id;b=b?d("#c"+parseInt(b)).parent("li.comment-wrapper"):z(e);if(a.use_threadedcomments){e=b.children("ul:last");0==e.length&&(e=b.children(".js-comments-form"),0<e.length?(e.before('<ul class="comment-list-wrapper"></ul>'),e=b.children("ul")):(b.append('<ul class="comment-list-wrapper"></ul>'),e=b.children("ul:last")));if(c)return b=e.find("li.comment-preview:last"),0==b.length&&(e.append('<li class="comment-wrapper comment-preview"></li>'),b=
e.find("li.comment-preview")),b;e.append('<li class="comment-wrapper"></li>');return e.children("li:last")}return b}function E(a){var c=z(a.object_id);if(a.use_threadedcomments)b=y(a,!0);else{var b=c.find(".comment-preview-area");0==b.length&&(c.append('<div class="comment-preview-area"></div>').addClass("has-preview"),b=c.children(".comment-preview-area"),x=!0)}c=b.hasClass("has-preview-loaded");b.html('<div class="comment-preview">'+a.html+"</div>").addClass("has-preview-loaded");c||b.hide().show(600);
setTimeout(function(){r(b,500,20)},500)}function z(a){a="#comments-"+a;var c=d(a);0==c.length&&alert("Internal error - unable to display comment.\n\nreason: container "+a+" is missing in the page.");return c}function w(a){a.find(".comment-waiting").hide().stop()}var t="html, body",n="";if(null==d)throw Error("jQuery needs to be loaded before ajaxcomments.js");d.fn.ready(function(){var a=d("form.js-comments-form");0<a.length&&(a.find(":input").focus(m).mousedown(m),a.submit(A));if(d.fn.on)d("body").on("click",
".comment-reply-link",u);else d(".comment-reply-link").live("click",u);d(".comment-cancel-reply-link").click(D);d(".js-comments-form").each(function(){var a=d(this),b=a.attr("data-object-id");a.wrap('<div class="js-comments-form-orig-position" id="comments-form-orig-position-'+b+'"></div>')});a=d("div.comments");a.filter("#comments-None").add(a.filter("#comments-")).each(function(){for(var a=this.parentNode,b=0;4>b;b++){var e=d(a).find(".js-comments-form");if(e.length){(a=e.attr("data-object-id"))&&
d(this).attr("id","comments-"+a).attr("data-object-id",a);break}a=a.parentNode;if(!a)break}});d("html, body").each(function(){var a=d(this),b=a.attr("scrollTop");a.attr("scrollTop",b+1);if(a.attr("scrollTop")==b+1)return t=this.nodeName.toLowerCase(),a.attr("scrollTop",b),!1});a=window.location.hash;"#c"==a.substring(0,2)&&(a=parseInt(a.substring(2)),isNaN(a)||p(a,1E3))});var x=!1})(window.jQuery);